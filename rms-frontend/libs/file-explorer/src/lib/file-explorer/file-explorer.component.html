<div (dragover)="dragged = true">
  <mat-toolbar>
    <button mat-icon-button *ngIf="canNavigateUp" (click)="navigateUp()">
      <mat-icon>
        arrow_back
      </mat-icon>
    </button>
    <span style="margin-left: 8px"> {{ path || 'Files' }} </span>
    <span class="spacer"></span>
    <span style="font-size: small;" *ngIf="selected.length"
      >{{ selected.length }} File(s) Selected</span
    >
    <button *ngIf="selected.length" mat-icon-button (click)="selected = []">
      <mat-icon>
        clear
      </mat-icon>
    </button>
    <button mat-icon-button (click)="openNewFolderDialog()">
      <mat-icon>
        create_new_folder
      </mat-icon>
    </button>
    <button mat-icon-button (click)="uploader.click()">
      <mat-icon>
        cloud_upload
      </mat-icon>
    </button>
  </mat-toolbar>

  <div
    class="container"
    fxFlex
    fxLayout="row"
    fxLayoutAlign="space-between stretch"
  >
    <div class="content" fxFlex fxLayout="row">
      <mat-grid-list cols="8" rowHeight="100px" fxFlex>
        <mat-grid-tile
          *ngFor="let element of _fileElements"
          class="file-or-folder"
        >
          <span
            [matMenuTriggerFor]="rootMenu"
            [matMenuTriggerData]="{ element: element }"
            #menuTrigger="matMenuTrigger"
          >
          </span>
          <div
            style="display: flex; align-content: space-between; flex-direction: column; padding: 15px;"
            [ngStyle]="{
              'background-color': selected.includes(element) ? 'grey' : ''
            }"
            (click)="navigate(element, $event)"
            (contextmenu)="menuTrigger.openMenu(); $event.preventDefault()"
          >
            <mat-icon
              color="primary"
              class="file-or-folder-icon pointer"
              *ngIf="element.isFolder"
            >
              folder
            </mat-icon>
            <mat-icon
              color="primary"
              class="file-or-folder-icon pointer"
              *ngIf="!element.isFolder"
            >
              insert_drive_file
            </mat-icon>

            <span>{{ element.name }}</span>
          </div>
        </mat-grid-tile>
      </mat-grid-list>
    </div>
  </div>
  <mat-menu #rootMenu="matMenu" [overlapTrigger]="false">
    <ng-template matMenuContent let-element="element">
      <button
        mat-menu-item
        [matMenuTriggerFor]="moveToMenu"
        [matMenuTriggerData]="{ self: element }"
      >
        <mat-icon>open_with</mat-icon>
        <span>Move To</span>
      </button>
      <button
        mat-menu-item
        (click)="openRenameDialog(element)"
        [disabled]="selected.length"
      >
        <mat-icon>edit</mat-icon>
        <span>Rename</span>
      </button>
      <button mat-menu-item (click)="deleteElement(element)">
        <mat-icon>delete</mat-icon>
        <span>Delete</span>
      </button>
    </ng-template>
  </mat-menu>

  <mat-menu #moveToMenu="matMenu">
    <ng-template matMenuContent let-self="self">
      <ng-container *ngFor="let element of _fileElements">
        <button
          *ngIf="
            element.isFolder &&
            element.id !== self.id &&
            !selected.includes(element)
          "
          mat-menu-item
          (click)="moveElement(self, element)"
        >
          {{ element.name }}
        </button>
      </ng-container>
    </ng-template>
  </mat-menu>
</div>

<ngx-file-drop
  *ngIf="dragged"
  dropZoneLabel="Drop files here"
  dropZoneClassName="drop-area"
  contentClassName="drop-content"
  (onFileDrop)="dropped($event); dragged = false"
  (onFileOver)="fileOver($event)"
  (onFileLeave)="fileLeave($event); dragged = false"
>
</ngx-file-drop>

<input hidden multiple type="file" #uploader (change)="uploadFile($event)" />
